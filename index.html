<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jarvis - AI Overlay Assistant</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Default overlay opacity 100% from first paint; Answer screen buttons always 1 -->
    <style id="overlay-opacity-style">.minimal-hud,.drag-output,#drag-output,.messages-container,.humanize-btn,.reveal-history-btn,.action-buttons-container{opacity:1 !important}#answer-this-btn,#answer-this-btn-moved,.answer-this-btn{opacity:1 !important}</style>
    <!-- KaTeX for math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" crossorigin="anonymous"></script>
</head>
<body>
    <!-- Full-window screenshot so HUD backdrop-filter has real content to blur -->
    <div id="screen-blur-bg" class="screen-blur-bg" aria-hidden="true"></div>
    <!-- Sits behind HUD only; HUD's backdrop-filter blurs this (so blur is visible in Electron) -->
    <div id="blur-backdrop" class="blur-backdrop" aria-hidden="true"></div>
    <!-- Chrome-style snap drop zone (shown when dragging toward left/right edge) -->
    <div id="snap-drop-zone" class="snap-drop-zone hidden" aria-hidden="true"></div>
    <!-- True floating overlay - no container -->
    <div id="jarvis-overlay" class="overlay">
        
        <!-- Set Password Notification -->
        <div id="set-password-notification" class="set-password-notification hidden">
            <div class="password-notification-content">
                <span class="password-notification-icon">üîê</span>
                <span class="password-notification-text">Set a password to secure your account</span>
                <button id="password-notification-open-btn" class="password-notification-btn">Open</button>
                <button id="password-notification-dismiss-btn" class="password-notification-dismiss">√ó</button>
            </div>
        </div>
        
        <!-- Sleek minimal HUD -->
        <!-- Attachments bar (appears when files are attached) -->
        <div id="attachments-bar" class="attachments-bar hidden"></div>

        <!-- Main HUD (whole bar is draggable) -->
        <div class="minimal-hud">
            <div class="input-section input-section-with-slash">
                <textarea id="text-input" placeholder="Ask Jarvis, / for commands" rows="1"></textarea>
                <div id="slash-command-menu" class="slash-command-menu hidden" role="listbox">
                    <div class="slash-command-section">
                        <div class="slash-command-section-title">Skills</div>
                        <div id="slash-command-list" class="slash-command-list"></div>
                    </div>
                </div>
            </div>
            <div id="message-counter" class="message-counter hidden">
                <span id="message-count-text">0/10</span>
            </div>
            <button id="settings-btn" class="settings-btn" title="Settings">
                <div class="menu-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </button>
        </div>
        <button id="answer-this-btn" class="answer-this-btn answer-this-default" title="Capture screen and get an answer (or paste the question if screenshot is blank)">Answer screen</button>
        
        <!-- Settings menu -->
        <div id="settings-menu" class="settings-menu hidden">
            <div class="settings-item settings-item-submenu" id="model-switcher-btn">
                <span class="settings-text">Model: <span id="current-model-display">ChatGPT 5.2</span></span>
                <svg width="10" height="6" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg" class="submenu-arrow">
                    <path d="M9 1L5 5L1 1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <div id="model-submenu" class="model-submenu hidden">
                <!-- Main models (always visible) -->
                <div class="model-item" data-model="default" data-tier="high">
                    <span class="model-name">ChatGPT 5.2</span>
                    <span class="model-desc">OpenAI's flagship model</span>
                    <div class="tier-toggle" id="jarvis-tier-toggle">
                        <label class="tier-switch">
                            <input type="checkbox" id="tier-toggle-checkbox" checked>
                            <span class="tier-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="model-item" data-model="google/gemini-3-pro-preview" data-tier="high">
                    <span class="model-name">Gemini 3 Pro</span>
                    <span class="model-desc">Google's newest model</span>
                </div>
                <div class="model-item" data-model="anthropic/claude-sonnet-4.5" data-tier="high">
                    <span class="model-name">Claude Sonnet 4.5</span>
                    <span class="model-desc">Best for reasoning</span>
                </div>
                <div class="model-item" data-model="x-ai/grok-4.1-fast" data-tier="high">
                    <span class="model-name">Grok 4.1 Fast</span>
                    <span class="model-desc">xAI's fast model</span>
                </div>
                
                <!-- More models button -->
                <div class="model-more-btn" id="model-more-btn">
                    <span>More models</span>
                    <svg width="10" height="6" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M1 1L5 5L9 1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                
                <!-- More models: populated from main (defaults Opus/DeepSeek/Llama/Kimi + any added from "Browse more models") -->
                <div id="more-models-section" class="more-models-section hidden">
                </div>
                <!-- Browse more models from OpenRouter (bottom of list) -->
                <div class="browse-more-models-btn" id="browse-more-models-btn">
                    <span>Browse more models</span>
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 2V10M2 6H10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                </div>
            </div>
            <div class="settings-item settings-item-submenu" id="settings-submenu-btn">
                <span class="settings-text">Settings</span>
                <svg width="10" height="6" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg" class="submenu-arrow">
                    <path d="M9 1L5 5L1 1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <div id="settings-submenu" class="settings-submenu hidden">
                <div class="settings-item" id="lockdown-launcher-btn" title="Runs a watcher that relaunches Jarvis when Lockdown kills it" style="display:none">
                    <span class="settings-text">Run Lockdown Launcher</span>
                </div>
                <div class="settings-item settings-item-toggle" id="stealth-mode-toggle">
                    <span class="settings-text">Cheat Mode</span>
                    <label class="toggle-switch" for="stealth-mode-checkbox">
                        <input type="checkbox" id="stealth-mode-checkbox">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-item" id="opacity-slider-item">
                    <span class="settings-text">Opacity</span>
                    <div class="slider-container">
                        <input type="range" id="opacity-slider" min="5" max="100" value="100" 
                               ondblclick="this.value=100; window.handleOpacitySlider(100);"
                               oninput="window.handleOpacitySlider(this.value)" 
                               onchange="window.handleOpacitySlider(this.value)">
                    </div>
                </div>
                <div class="settings-item" id="color-picker-item">
                    <span class="settings-text">Color</span>
                    <div class="color-options-row">
                        <div class="color-dot" data-color="#000000" style="background: #000000; border: 1px solid rgba(255,255,255,0.3);" onclick="event.stopPropagation(); window.handleColorPicker('#000000')"></div>
                        <div class="color-dot" data-color="#ffffff" style="background: #ffffff;" onclick="event.stopPropagation(); window.handleColorPicker('#ffffff')"></div>
                        <div class="color-dot" data-color="#ec4899" style="background: #ec4899;" onclick="event.stopPropagation(); window.handleColorPicker('#ec4899')"></div>
                        <div class="color-dot" data-color="#4A9EFF" style="background: #4A9EFF;" onclick="event.stopPropagation(); window.handleColorPicker('#4A9EFF')"></div>
                    </div>
                </div>
                <div class="settings-item" id="hotkeys-btn">
                    <span class="settings-text">Hotkeys</span>
                </div>
                <div class="settings-item settings-item-update hidden" id="update-available-menu-item">
                    <span class="settings-text">üîÑ Update Available</span>
                    <span class="settings-version" id="update-version-display">v1.0.0</span>
                </div>
            </div>
            <div class="settings-item" id="account-info-btn">
                <span class="settings-text">Account</span>
            </div>
            <div class="settings-item" id="clear-chat-btn">
                <span class="settings-text">Clear Chat History</span>
            </div>
            <div class="settings-item" id="settings-close-btn">
                <span class="settings-text">Quit Jarvis</span>
            </div>
        </div>
        
        
        <!-- Arrow button to reveal chat history -->
        <button id="reveal-history-btn" class="reveal-history-btn hidden" title="Show chat history">
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 2L10 6L2 6L6 2Z" fill="currentColor"/>
            </svg>
        </button>
        
        <!-- Messages container - scrollable, contains all messages -->
        <div id="messages-container" class="messages-container hidden">
            <!-- Previous messages will be dynamically added here (hidden above) -->
            <!-- Current output message will be added here (visible at bottom) -->
        </div>
        
        <!-- Draggable output chip - current visible message (will be moved into messages-container) -->
        <div id="drag-output" class="drag-output hidden" draggable="true" title="Drag me to drop text into apps">
            <!-- Resize handle -->
            <div id="resize-handle" class="resize-handle" title="Drag to resize"></div>
        </div>
        <!-- Action buttons container -->
        <div class="action-buttons-container hidden" id="action-buttons-container">
            <button id="answer-this-btn-moved" class="answer-this-btn hidden" title="Capture screen and get an answer (or paste the question if screenshot is blank)">Answer screen</button>
            <!-- Grok Voice button (shows when Grok model is selected) -->
            <button id="grok-voice-btn" class="grok-voice-btn hidden" title="Toggle voice responses">
                <svg class="voice-inactive" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="4" cy="10" r="1.2" fill="currentColor"/>
                    <circle cx="8" cy="10" r="1.2" fill="currentColor"/>
                    <circle cx="12" cy="10" r="1.2" fill="currentColor"/>
                    <circle cx="16" cy="10" r="1.2" fill="currentColor"/>
                </svg>
                <svg class="voice-active" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="2" y="7" width="2" height="6" rx="1" fill="currentColor"/>
                    <rect x="6" y="4" width="2" height="12" rx="1" fill="currentColor"/>
                    <rect x="10" y="2" width="2" height="16" rx="1" fill="currentColor"/>
                    <rect x="14" y="4" width="2" height="12" rx="1" fill="currentColor"/>
                </svg>
            </button>
            <!-- Voice selector button (toggle between voices) -->
            <button id="voice-select-btn" class="voice-select-btn hidden" title="Switch voice">
                <span class="voice-icon">‚ôÄ</span>
            </button>
        </div>
        
        <!-- Floating close button positioned outside the output box -->
        <button id="close-output-floating" class="close-output-floating hidden" aria-label="Hide output" title="Hide">√ó</button>
    </div>

    <!-- Activation indicator -->
    <div id="activation-indicator" class="activation-indicator hidden">
        <div class="activation-content">
            <div class="jarvis-logo">ü§ñ</div>
            <div class="activation-text">Jarvis Activated</div>
        </div>
    </div>

    <!-- Hidden file input for Add File action -->
    <input id="file-input" type="file" multiple class="hidden" accept="*/*" />

    <!-- Account Info Modal -->
    <div id="account-modal" class="account-modal hidden">
        <div class="account-modal-content">
            <div class="account-modal-header">
                <h3>Account & Premium Status</h3>
                <button id="account-modal-close" class="account-modal-close">√ó</button>
            </div>
            <div class="account-modal-body">
                <div class="account-info">
                    <div class="account-section">
                        <div class="account-label">Account:</div>
                        <div id="user-email" class="account-value">Free Tier</div>
                    </div>
                    <div class="account-section">
                        <div class="account-label">Premium Status:</div>
                        <div id="premium-status" class="account-value">Free</div>
                    </div>
                    <div class="account-section">
                        <div class="account-label">Features:</div>
                        <div id="feature-list" class="feature-list">
                            <div class="feature-item">‚úÖ Screenshot Analysis</div>
                            <div class="feature-item">‚úÖ Web Search</div>
                            <div class="feature-item">‚ùå Document Processing</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="account-modal-footer">
                <button id="account-modal-ok" class="account-modal-btn">OK</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>